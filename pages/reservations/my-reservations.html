<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Reservas - OnePath</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/reset.css">
    <link rel="stylesheet" href="../../css/global.css">
    <link rel="stylesheet" href="../../css/components/navbar.css">
    <link rel="stylesheet" href="../../css/components/buttons.css">
    <link rel="stylesheet" href="../../css/components/cards.css">
    <link rel="stylesheet" href="../../css/components/notifications.css">
    <link rel="stylesheet" href="../../css/components/modals.css">
    <link rel="stylesheet" href="../../css/components/forms.css">
    <link rel="stylesheet" href="../../css/components/footer.css">
    <link rel="stylesheet" href="../../css/pages/trips.css">
    <!-- Inicializa almacenamiento y permite cambio rápido de usuario via query param -->
    <script src="../../js/utils/storage.js" defer></script>
    <script src="../../js/utils/quick-user-switch.js" defer></script>
    <!-- Navbar depende de currentUser, mantener después del switch -->
    <script id="navbar-script" src="../../js/components/navbar.js" data-base-prefix="../../" defer></script>
</head>
<body>
    <!-- Header (renderizado por componente) -->
    <div id="navbar"></div>

    <!-- Main Content -->
    <main class="my-trips-page-main">
        <div class="container">
            <!-- Breadcrumbs -->
            <nav class="breadcrumbs" aria-label="Breadcrumb">
                <a href="../../index.html">Inicio</a>
                <span class="breadcrumb-separator">›</span>
                <a href="../user/profile.html">Mi Perfil</a>
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-current">Mis Reservas</span>
            </nav>

            <!-- Header Section -->
            <header class="my-trips-header">
                <div class="my-trips-header-content">
                    <h1 class="my-trips-title">Mis Reservas</h1>
                    <p class="my-trips-subtitle">Gestiona todos tus viajes como pasajero</p>
                </div>
                <div class="my-trips-badges">
                    <span class="trip-badge trip-badge--active" id="activeTripsBadge">
                        <span class="badge-count" id="activeTripsCount">0</span> Viajes Activos
                    </span>
                    <span class="trip-badge trip-badge--completed" id="completedTripsBadge">
                        <span class="badge-count" id="completedTripsCount">0</span> Viajes Completados
                    </span>
                </div>
            </header>

            <!-- Loading State -->
            <div class="loading-state" id="loadingState" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Cargando tus viajes...</p>
            </div>

            <!-- Main Content Layout -->
            <div class="my-trips-layout" id="tripsContent" style="display: none;">
                
                <div class="my-trips-main">
                    <!-- Tabs estilo píldora -->
                    <div class="reservation-tabs" role="tablist">
                        <button class="reservation-tab active" data-tab="upcoming" role="tab" aria-selected="true" id="tabUpcoming">
                            Viajes Próximos
                            <span class="reservation-tab-badge" id="upcomingBadge">0</span>
                        </button>
                        <button class="reservation-tab" data-tab="history" role="tab" aria-selected="false" id="tabHistory">
                            Historial
                            <span class="reservation-tab-badge" id="historyBadge">0</span>
                        </button>
                        <button class="reservation-tab" data-tab="cancelled" role="tab" aria-selected="false" id="tabCancelled">
                            Cancelados
                            <span class="reservation-tab-badge" id="cancelledBadge">0</span>
                        </button>
                    </div>

                    <!-- Empty State -->
                    <div class="empty-state" id="emptyState" style="display: none;">
                        <div class="empty-state-icon"><span class="material-icons">directions_car</span></div>
                        <h2>No tienes viajes reservados</h2>
                        <p>Aún no has reservado ningún viaje. ¡Comienza buscando tu primer viaje!</p>
                        <a href="../trips/search.html" class="btn-text btn-full btn-small">Buscar Viaje</a>
                    </div>

                    <!-- Reservations List -->
                    <div class="trips-list-container" id="reservationsList">
                        <div class="trips-list" id="reservationsListContent">
                            <!-- Las reservas se cargarán dinámicamente aquí -->
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Sidebar -->
                <aside class="my-trips-sidebar">
                    <!-- Statistics -->
                    <section class="sidebar-section">
                        <h2 class="sidebar-title">Estadísticas</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Total de viajes</span>
                                <span class="stat-value" id="totalTripsStat">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Dinero ahorrado</span>
                                <span class="stat-value stat-value--success" id="moneySavedStat">S/ 0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Calificación promedio</span>
                                <span class="stat-value" id="avgRatingStat">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">CO2 ahorrado</span>
                                <span class="stat-value" id="co2SavedStat">0 kg</span>
                            </div>
                        </div>
                    </section>

                    <!-- Quick Actions -->
                    <section class="sidebar-section">
                        <h2 class="sidebar-title">Acciones Rápidas</h2>
                        <div class="quick-actions">
                            <a href="../trips/search.html" class="quick-action-btn quick-action-btn--search">
                                <span class="action-icon material-icons">search</span>
                                Buscar Nuevo Viaje
                            </a>
                            <a href="../trips/publish.html" class="quick-action-btn quick-action-btn--publish">
                                <span class="action-icon material-icons">add</span>
                                Ofrecer Viaje
                            </a>
                            <a href="../trips/my-trips.html" class="quick-action-btn quick-action-btn--regular">
                                <span class="action-icon material-icons">calendar_today</span>
                                Viajes Regulares
                            </a>
                        </div>
                    </section>

                    <!-- Recent Activity -->
                    <section class="sidebar-section">
                        <h2 class="sidebar-title">Actividad Reciente</h2>
                        <div class="activity-list" id="recentActivity">
                            <!-- Se cargará dinámicamente -->
                        </div>
                    </section>

                    <!-- Help Section -->
                    <section class="sidebar-section">
                        <h2 class="sidebar-title">¿Necesitas Ayuda?</h2>
                        <p class="help-text">Consulta nuestras guías o contacta con soporte para resolver cualquier duda sobre tus viajes.</p>
                        <div class="help-actions">
                            <a href="#" class="btn-text btn-full btn-small">Centro de Ayuda</a>
                            <a href="#" class="btn-text btn-full btn-small">Contactar Soporte</a>
                        </div>
                    </section>
                </aside>
            </div>
        </div>
    </main>

    <!-- Cancel Reservation Modal -->
    <div class="modal" id="cancelModal" role="dialog" aria-labelledby="cancelModalTitle" aria-modal="true" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-content--small">
            <div class="modal-header">
                <h2 class="modal-title" id="cancelModalTitle">Cancelar Reserva</h2>
                <button class="modal-close" id="closeCancelModal" aria-label="Cerrar modal">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-warning">
                    <div class="warning-icon material-icons">warning</div>
                    <p id="cancelModalMessage">¿Estás seguro de que deseas cancelar esta reserva?</p>
                </div>
                <div class="form-group">
                    <label for="cancelReasonInput">Motivo de la cancelación (opcional)</label>
                    <textarea id="cancelReasonInput" rows="3" placeholder="Cuéntanos el motivo"></textarea>
                </div>
                <p class="modal-note" style="font-size: 12px; color: var(--text-light); margin-top: 8px;">
                    Antes de cancelar, revisa nuestras <a href="#" id="cancelPoliciesLink">políticas de cancelación</a>.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelCancelBtn">No, mantener</button>
                <button type="button" class="btn-danger" id="confirmCancelBtn">
                    <span class="btn-icon material-icons">close</span>
                    Cancelar Reserva
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo-section">
                    <div class="footer-logo">
                        <div class="logo-icon"><span class="material-icons">directions_car</span></div>
                        <span>OnePath</span>
                    </div>
                    <p>Conectando estudiantes universitarios con viajes seguros y acomodaciones económicas</p>
                </div>
                <div class="footer-links">
                    <a href="#">Términos y Condiciones</a>
                    <a href="#">Política de Privacidad</a>
                    <a href="#">Soporte</a>
                    <a href="#">Contacto</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/utils/demo-seed.js" defer></script>
    <script src="../../js/reservations/my-reservations.js" defer></script>
</body>
</html>

